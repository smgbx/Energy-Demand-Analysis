SPARKSQL CODES
TABLE CREATION Weather
import csv
from pyspark.sql import SparkSession
import pyspark.sql.functions as filter
Spark = SparkSession \
    .builder \
    .appName("Spark project") \
    .getOrCreate()
#part1 question 1
df = Spark.read.csv(r"/content/weather_features.csv",header=True)
df.createOrReplaceTempView("Weather")
TABLE CREATION Energy
import csv
from pyspark.sql import SparkSession
import pyspark.sql.functions as filter
Spark = SparkSession \
    .builder \
    .appName("Spark project") \
    .getOrCreate()
#part1 question 1
df = Spark.read.csv(r"/content/energy_dataset.csv",header=True)
df.createOrReplaceTempView("Energy")

QUERIES
Spark.sql("select * from Weather where city_name = 'Madrid' or weather_main = 'clouds'").createTempView("madrid")
Spark.sql("select dt_iso,city_name,temp_max,temp_min from Weather where city_name = 'Madrid' ORDER BY temp_max desc").show()
+-------------------+---------+--------+--------+
|             dt_iso|city_name|temp_max|temp_min|
+-------------------+---------+--------+--------+
|2016-09-06 14:00:00|   Madrid|  316.48|  307.04|
|2016-09-06 15:00:00|   Madrid|  316.48|  308.15|
|2016-09-07 15:00:00|   Madrid|  315.37|  309.05|
|2017-07-13 18:00:00|   Madrid|  315.15|  310.15|
|2016-09-06 13:00:00|   Madrid|  314.82|  303.71|
|2016-09-07 14:00:00|   Madrid|  314.82|  307.04|
|2015-07-07 12:00:00|   Madrid|  314.75|  305.15|
|2015-06-28 12:00:00|   Madrid|  314.65|  304.15|
|2015-07-08 12:00:00|   Madrid|  314.55|  305.15|
|2015-07-07 11:00:00|   Madrid|  314.25|  303.15|
|2015-07-14 12:00:00|   Madrid|  314.25|  303.71|
|2015-07-06 19:00:00|   Madrid|  314.15|  310.75|
|2015-07-06 20:00:00|   Madrid|  314.15|  309.75|
|2017-07-14 18:00:00|   Madrid|  314.15|  310.15|
|2017-07-13 20:00:00|   Madrid|  314.15|  310.15|
|2017-07-13 17:00:00|   Madrid|  314.15|  310.15|
|2017-07-14 19:00:00|   Madrid|  314.15|  310.15|
|2018-08-03 18:00:00|   Madrid|  314.15|  310.15|
|2017-07-13 19:00:00|   Madrid|  314.15|  310.15|
|2018-08-03 17:00:00|   Madrid|  314.15|  310.15|
+-------------------+---------+--------+--------+
only showing top 20 rows
Spark.sql("select generation_hydro_water_reservoir,price_actual from Energy").show()
[ ]
Spark.sql("select generation_hydro_water_reservoir,price_actual from Energy").show()
+--------------------------------+------------+
|generation_hydro_water_reservoir|price_actual|
+--------------------------------+------------+
|                          1899.0|       65.41|
|                          1658.0|       64.92|
|                          1371.0|       64.48|
|                           779.0|       59.32|
|                           720.0|       56.04|
|                           743.0|       53.63|
|                           848.0|       51.73|
|                          1012.0|       51.43|
|                          1015.0|       48.98|
|                          1357.0|        54.2|
|                          1817.0|       58.94|
|                          1516.0|       59.86|
|                          1204.0|       60.12|
|                          1286.0|       62.05|
|                          1027.0|       62.06|
|                          1151.0|       59.76|
|                          1156.0|       61.18|
|                          1626.0|       64.74|
|                          3203.0|       74.26|
|                          5333.0|       74.24|
+--------------------------------+------------+
only showing top 20 rows
Spark.sql("select * from madrid_Table union select * from barcelona_Table order by city_name").show(50)
------+--------+--------+----------+--------+-------+-------+-------+----------+----------+------------+-------------------+------------+
|             dt_iso| city_name|        temp|    temp_min|    temp_max|pressure|humidity|wind_speed|wind_deg|rain_1h|rain_3h|snow_3h|clouds_all|weather_id|weather_main|weather_description|weather_icon|
+-------------------+----------+------------+------------+------------+--------+--------+----------+--------+-------+-------+-------+----------+----------+------------+-------------------+------------+
|2015-01-05 21:00:00| Barcelona|      285.36|      285.36|      285.36|    1024|      86|         1|       0|    0.0|    0.0|    0.0|        12|       801|      clouds|         few clouds|         02n|
|2016-10-10 20:00:00| Barcelona|     289.995|     289.995|     289.995|    1022|     100|         2|     159|    0.0|    0.0|    0.0|        76|       803|      clouds|      broken clouds|         04n|
|2015-01-21 09:00:00| Barcelona|     280.555|     280.555|     280.555|    1004|      57|         2|     340|    0.0|    0.0|    0.0|        80|       803|      clouds|      broken clouds|          04|
|2015-02-27 05:00:00| Barcelona|284.19334375|284.19334375|284.19334375|    1013|      90|         1|     202|    0.0|    0.0|    0.0|        84|       803|      clouds|      broken clouds|          04|
|2015-04-15 22:00:00| Barcelona|288.15634375|288.15634375|288.15634375|    1017|      81|         5|      53|    0.0|    0.0|    0.0|        84|       803|      clouds|      broken clouds|          04|
|2015-04-24 18:00:00| Barcelona|    290.1625|    290.1625|    290.1625|    1017|      86|         5|     215|    0.0|    0.0|    0.0|        38|       802|      clouds|   scattered clouds|          03|
|2015-04-25 22:00:00| Barcelona|    289.0965|    289.0965|    289.0965|    1015|      96|         3|     214|    0.0|    0.0|    0.0|        64|       803|      clouds|      broken clouds|          04|
|2015-05-01 06:00:00| Barcelona|    287.8345|    287.8345|    287.8345|    1016|      98|         6|     234|    0.0|    0.0|    0.0|        28|       802|      clouds|   scattered clouds|          03|
|2015-05-30 09:00:00| Barcelona|     292.357|     292.357|     292.357|    1020|      80|         1|     123|    0.0|    0.0|    0.0|        56|       803|      clouds|      broken clouds|         04d|
|2015-07-03 08:00:00| Barcelona|      298.11|      294.26|      302.04|    1022|      50|         3|     340|    0.0|    0.0|    0.0|        20|       801|      clouds|         few clouds|         02d|
|2015-07-24 12:00:00| Barcelona|      302.91|      297.59|      308.71|    1011|      66|         5|     220|    0.0|    0.0|    0.0|        20|       801|      clouds|         few clouds|         02d|
|2015-07-29 18:00:00| Barcelona|      302.15|      297.59|      305.37|    1010|      70|         6|     210|    0.0|    0.0|    0.0|        20|       801|      clouds|         few clouds|         02d|
|2015-08-01 15:00:00| Barcelona|      298.03|      294.26|      302.04|    1015|      65|         4|     100|    0.0|    0.0|    0.0|        40|       802|      clouds|   scattered clouds|         03d|
|2015-08-23 08:00:00| Barcelona|      294.92|      290.37|      298.15|    1008|      78|         4|     330|    0.0|    0.0|    0.0|        75|       803|      clouds|      broken clouds|         04d|
|2015-08-24 21:00:00| Barcelona|      296.73|      291.48|      299.82|    1013|      69|         8|      60|    0.0|    0.0|    0.0|        20|       801|      clouds|         few clouds|         02n|
|2015-09-08 22:00:00| Barcelona|      292.33|      288.71|      296.48|    1017|      64|         1|       0|    0.0|    0.0|    0.0|        20|       801|      clouds|         few clouds|         02n|
|2015-09-09 18:00:00| Barcelona|       297.3|      292.59|      302.59|    1015|      57|         3|     200|    0.0|    0.0|    0.0|        20|       801|      clouds|         few clouds|         02d|
|2015-09-22 03:00:00| Barcelona|      289.73|      285.37|      292.59|    1014|      88|         3|     330|    0.0|    0.0|    0.0|        40|       802|      clouds|   scattered clouds|         03n|
|2015-09-25 13:00:00| Barcelona|      295.72|      293.15|      298.71|    1018|      64|         4|     100|    0.0|    0.0|    0.0|        20|       801|      clouds|         few clouds|         02d|
|2015-10-23 17:00:00| Barcelona|      293.15|      293.15|      293.15|    1020|      60|         4|     240|    0.0|    0.0|    0.0|        20|       801|      clouds|         few clouds|         02d|
|2015-10-25 17:00:00| Barcelona|      291.15|      291.15|      291.15|    1020|      82|         2|      80|    0.0|    0.0|    0.0|        20|       801|      clouds|         few clouds|         02d|
|2015-10-26 00:00:00| Barcelona|      290.15|      290.15|      290.15|    1019|      82|         2|      10|    0.0|    0.0|    0.0|        20|       801|      clouds|         few clouds|         02n|
|2015-11-15 17:00:00| Barcelona|      291.15|      291.15|      291.15|    1022|      82|         5|     230|    0.0|    0.0|    0.0|        20|       801|      clouds|         few clouds|         02d|
|2015-11-16 18:00:00| Barcelona|    290.7675|    290.7675|    290.7675|    1020|      60|         1|     103|    0.0|    0.0|    0.0|        18|       801|      clouds|         few clouds|          02|
|2015-11-24 07:00:00| Barcelona|      276.15|      276.15|      276.15|    1023|      59|         4|     330|    0.0|    0.0|    0.0|        20|       801|      clouds|         few clouds|         02n|
|2015-11-24 11:00:00| Barcelona|      280.15|      280.15|      280.15|    1025|      48|         4|     330|    0.0|    0.0|    0.0|        20|       801|      clouds|         few clouds|         02d|
|2015-12-09 10:00:00| Barcelona|      286.15|      286.15|      286.15|    1037|      82|         3|     330|    0.0|    0.0|    0.0|        20|       801|      clouds|         few clouds|         02d|
|2015-12-09 20:00:00| Barcelona|      286.15|      286.15|      286.15|    1035|      82|         2|     330|    0.0|    0.0|    0.0|        20|       801|      clouds|         few clouds|         02n|
|2015-12-13 04:00:00| Barcelona|      280.15|      280.15|      280.15|    1023|      93|         3|     310|    0.0|    0.0|    0.0|        20|       801|      clouds|         few clouds|         02n|
|2015-12-13 11:00:00| Barcelona|      282.15|      282.15|      282.15|    1022|      73|         5|     330|    0.0|    0.0|    0.0|        20|       801|      clouds|         few clouds|          02|
|2015-12-27 20:00:00| Barcelona|      283.68|      279.82|      285.93|    1032|      93|         2|     280|    0.0|    0.0|    0.0|        20|       801|      clouds|         few clouds|         02n|
|2016-01-03 09:00:00| Barcelona|      280.87|      275.37|      283.71|    1015|      65|         2|     320|    0.0|    0.0|    0.0|        20|       801|      clouds|         few clouds|         02d|
|2016-01-09 06:00:00| Barcelona|     287.225|     287.225|     287.225|    1005|      77|         5|     242|    0.0|    0.0|    0.0|        20|       801|      clouds|         few clouds|          02|
|2016-01-26 16:00:00| Barcelona|      288.15|      288.15|      288.15|    1030|      84|         4|     200|    0.0|    0.0|    0.0|        20|       801|      clouds|         few clouds|          02|
|2016-01-31 16:00:00| Barcelona|      288.15|      288.15|      288.15|    1026|      62|         3|     260|    0.0|    0.0|    0.0|        20|       801|      clouds|         few clouds|         02d|
|2016-02-06 04:00:00| Barcelona|      281.15|      281.15|      281.15|    1024|      81|         2|     320|    0.0|    0.0|    0.0|        20|       801|      clouds|         few clouds|         02n|
|2016-02-18 23:00:00| Barcelona|      281.15|      281.15|      281.15|    1021|      65|         2|     335|    0.0|    0.0|    0.0|        20|       801|      clouds|         few clouds|          02|
|2016-02-26 22:00:00| Barcelona|      285.15|      285.15|      285.15|    1001|      71|         1|     320|    0.0|    0.0|    0.0|        20|       801|      clouds|         few clouds|         02n|
|2016-02-28 11:00:00| Barcelona|      285.15|      285.15|      285.15|     999|      67|         9|      55|    0.0|    0.0|    0.0|        47|       802|      clouds|   scattered clouds|          03|
|2016-03-10 05:00:00| Barcelona|      277.65|      277.65|      277.65|    1006|      87|         5|     325|    0.0|    0.0|    0.0|        20|       801|      clouds|         few clouds|          02|
|2016-04-04 01:00:00| Barcelona|      287.15|      287.15|      287.15|    1013|      87|         3|     230|    0.0|    0.0|    0.0|        75|       803|      clouds|      broken clouds|         04n|
|2016-04-12 16:00:00| Barcelona|      290.15|      290.15|      290.15|    1011|      77|         4|     200|    0.0|    0.0|    0.0|        20|       801|      clouds|         few clouds|         02d|
|2016-04-18 06:00:00| Barcelona|      286.15|      286.15|      286.15|    1018|      82|         2|     330|    0.0|    0.0|    0.0|        20|       801|      clouds|         few clouds|         02n|
|2016-04-24 23:00:00| Barcelona|      286.31|      282.04|      288.15|    1014|      72|         4|     110|    0.0|    0.0|    0.0|        75|       803|      clouds|      broken clouds|         04n|
|2016-05-06 15:00:00| Barcelona|      292.32|      289.26|      295.37|    1014|      68|         6|      80|    0.0|    0.0|    0.0|        20|       801|      clouds|         few clouds|         02d|
|2016-05-16 11:00:00| Barcelona|      292.65|      290.93|      295.37|    1022|      45|         4|     320|    0.0|    0.0|    0.0|        20|       801|      clouds|         few clouds|         02d|
|2016-05-30 16:00:00| Barcelona|      294.99|      293.71|      295.93|    1015|      52|         4|     200|    0.0|    0.0|    0.0|        40|       802|      clouds|   scattered clouds|         03d|
|2016-07-21 23:00:00| Barcelona|      296.98|      294.26|      298.71|    1013|      73|         1|     100|    0.0|    0.0|    0.0|        20|       801|      clouds|         few clouds|         02n|
|2016-08-02 10:00:00| Barcelona|      299.01|      294.82|      303.15|    1020|      69|         3|     210|    0.0|    0.0|    0.0|        40|       802|      clouds|   scattered clouds|         03d|
|2016-09-15 16:00:00| Barcelona|      296.11|      292.59|      298.15|    1014|      36|         5|     220|    0.0|    0.0|    0.0|        20|       801|      clouds|         few clouds|         02d|
+-------------------+----------+------------+------------+------------+--------+--------+----------+--------+-------+-------+-------+----------+----------+------------+-------------------+------------+
only showing top 50 rows
Spark.sql("select * from Weather where weather_description = 'mist'").show()
+-------------------+---------+------+--------+--------+--------+--------+----------+--------+-------+-------+-------+----------+----------+------------+-------------------+------------+
|             dt_iso|city_name|  temp|temp_min|temp_max|pressure|humidity|wind_speed|wind_deg|rain_1h|rain_3h|snow_3h|clouds_all|weather_id|weather_main|weather_description|weather_icon|
+-------------------+---------+------+--------+--------+--------+--------+----------+--------+-------+-------+-------+----------+----------+------------+-------------------+------------+
|2015-03-04 08:00:00| Valencia|287.19|  286.15|  288.05|    1024|      87|         1|       0|    0.0|    0.0|    0.0|        90|       701|        mist|               mist|         50d|
|2015-03-04 09:00:00| Valencia| 286.7|  285.15|  288.05|    1025|      93|         1|       0|    0.0|    0.0|    0.0|        90|       701|        mist|               mist|         50d|
|2015-03-04 10:00:00| Valencia|287.19|  286.15|  288.05|    1026|      87|         0|       0|    0.0|    0.0|    0.0|        90|       701|        mist|               mist|         50d|
|2015-03-04 11:00:00| Valencia| 288.1|  288.05|  288.15|    1026|      82|         0|     104|    0.0|    0.0|    0.0|        40|       701|        mist|               mist|         50d|
|2015-11-07 20:00:00| Valencia|292.15|  292.15|  292.15|    1028|      88|         0|       0|    0.0|    0.0|    0.0|         0|       701|        mist|               mist|         50n|
|2015-11-07 22:00:00| Valencia|289.15|  289.15|  289.15|    1029|      93|         2|     320|    0.0|    0.0|    0.0|         0|       701|        mist|               mist|         50n|
|2015-11-08 02:00:00| Valencia|286.15|  286.15|  286.15|    1029|     100|         1|      54|    0.0|    0.0|    0.0|         0|       701|        mist|               mist|         50n|
|2015-11-08 04:00:00| Valencia|286.15|  286.15|  286.15|    1029|      93|         1|       0|    0.0|    0.0|    0.0|         0|       701|        mist|               mist|         50n|
|2015-11-09 01:00:00| Valencia|287.15|  287.15|  287.15|    1031|      93|         1|       0|    0.0|    0.0|    0.0|        48|       701|        mist|               mist|         50n|
|2015-11-09 03:00:00| Valencia|285.15|  285.15|  285.15|    1031|     100|         1|     290|    0.0|    0.0|    0.0|         8|       701|        mist|               mist|         50n|
|2015-11-09 22:00:00| Valencia|287.15|  287.15|  287.15|    1032|      93|         0|       0|    0.0|    0.0|    0.0|         0|       701|        mist|               mist|         50n|
|2015-11-10 00:00:00| Valencia|285.15|  285.15|  285.15|    1031|     100|         1|       0|    0.0|    0.0|    0.0|         0|       701|        mist|               mist|         50n|
|2015-11-10 02:00:00| Valencia|284.15|  284.15|  284.15|    1031|      93|         1|     301|    0.0|    0.0|    0.0|         0|       701|        mist|               mist|         50n|
|2015-11-10 04:00:00| Valencia|283.15|  283.15|  283.15|    1030|     100|         1|       0|    0.0|    0.0|    0.0|         0|       701|        mist|               mist|         50n|
|2015-11-11 22:00:00| Valencia|286.15|  286.15|  286.15|    1025|      93|         1|       0|    0.0|    0.0|    0.0|         0|       701|        mist|               mist|         50n|
|2015-11-12 00:00:00| Valencia|285.15|  285.15|  285.15|    1025|      93|         1|       0|    0.0|    0.0|    0.0|         0|       701|        mist|               mist|         50n|
|2015-11-12 02:00:00| Valencia|284.15|  284.15|  284.15|    1025|      93|         0|       0|    0.0|    0.0|    0.0|        20|       701|        mist|               mist|         50n|
|2015-11-12 04:00:00| Valencia|285.15|  285.15|  285.15|    1025|      93|         1|       0|    0.0|    0.0|    0.0|        75|       701|        mist|               mist|         50n|
|2015-11-14 02:00:00| Valencia|286.15|  286.15|  286.15|    1032|      93|         1|     307|    0.0|    0.0|    0.0|        20|       701|        mist|               mist|         50n|
|2015-11-14 04:00:00| Valencia|285.15|  285.15|  285.15|    1032|      93|         1|     300|    0.0|    0.0|    0.0|        32|       701|        mist|               mist|         50n|
+-------------------+---------+------+--------+--------+--------+--------+----------+--------+-------+-------+-------+----------+----------+------------+-------------------+------------+
only showing top 20 rows
Spark.sql("select avg(temp_max) from Weather").show()
+-----------------------------+
|avg(CAST(temp_max AS DOUBLE))|
+-----------------------------+
|            291.0912665669784|
+-----------------------------+
Spark.sql("select max(pressure) from Weather").show()
+-------------+
|max(pressure)|
+-------------+
|        99915|

Spark.sql("select forecast_solar_day_ahead,price_day_ahead from Energy ORDER by price_day_ahead").show()

+-------------++------------------------+---------------+
|forecast_solar_day_ahead|price_day_ahead|
+------------------------+---------------+
|                     5.0|           10.0|
|                  4632.0|           10.0|
|                   577.0|           10.0|
|                     0.0|           10.0|
|                     5.0|           10.0|
|                     1.0|           10.0|
|                   241.0|           10.0|
|                     0.0|           10.0|
|                  4507.0|           10.0|
|                  4947.0|           10.0|
|                   527.0|           10.0|
|                    72.0|           10.0|
|                     0.0|           10.0|
|                     2.0|           10.0|
|                   127.0|           10.0|
|                     5.0|           10.0|
|                  3451.0|           10.0|
|                  3452.0|           10.0|
|                  2070.0|           10.0|
|                     2.0|           10.0|
+------------------------+---------------+
only showing top 20 rows
Spark.sql("select distinct(city_name),temp_max,weather_main from weather where weather_main = 'clouds'").show()
+---------+------------+------------+
|city_name|    temp_max|weather_main|
+---------+------------+------------+
| Valencia|      290.55|      clouds|
| Valencia|     285.915|      clouds|
| Valencia|     289.036|      clouds|
| Valencia|289.13434375|      clouds|
| Valencia|      291.54|      clouds|
| Valencia|    290.2775|      clouds|
| Valencia| 291.3213125|      clouds|
| Valencia|     294.844|      clouds|
| Valencia|      295.84|      clouds|
| Valencia|    284.8215|      clouds|
| Valencia|     276.245|      clouds|
| Valencia|     278.185|      clouds|
| Valencia|    292.9595|      clouds|
| Valencia|      298.25|      clouds|
| Valencia|     292.765|      clouds|
|   Madrid| 286.5243125|      clouds|
|   Madrid|    293.4075|      clouds|
|   Madrid|     288.435|      clouds|
|   Madrid|      289.25|      clouds|
|   Bilbao|280.15534375|      clouds|
+---------+------------+------------+
only showing top 20 rows

